# 多线程——channel
[TOC]

Rust 中一个实现消息传递并发的主要工具是通道（channel），通道有两部分组成，一个发送者（transmitter）和一个接收者（receiver）。

std::sync::mpsc 包含了消息传递的方法：

```rust
use std::thread;
use std::sync::mpsc;

fn sub_thread(tx:   std::sync::mpsc::Sender<String>){
    let mut i=0;
    loop{
        let val = String::from("hi"+i);
        tx.send(val).unwrap();
        i++;
    }
}
fn main() {
    let (tx, rx) = mpsc::channel();
    thread::spawn(move || sub_thread(tx));
    loop{
        let received = rx.recv().unwrap();
        println!("Got: {}", received);
    }
}
```

这个就是一个简单的channel程序，子线程向主线程发送一个`hi`，主线程接收到，`println!`出来一句`Got: hi`

稍微增加一点功能，就是在hi,后面增加一个数字：
```rust
use std::thread;
use std::sync::mpsc;

fn sub_thread(tx:   std::sync::mpsc::Sender<String>){
    let mut i=0;
    loop{
        let mut val = String::from("hi--");
        val.push_str(&i.to_string());
        tx.send(val).unwrap();
        i+=1;
    }
}
fn main() {
    let (tx, rx) = mpsc::channel();
    thread::spawn(move || sub_thread(tx));
    loop{
        let received = rx.recv().unwrap();
        println!("Got: {}", received);
    }
}
```

在这个基础上，我们实现一下素数，素数比较有名的算法是Eratosthenes[^1]




## 解释
[^1]:埃拉托色尼筛选法(the Sieve of Eratosthenes)简称埃氏筛法，是古希腊数学家埃拉托色尼(Eratosthenes 274B.C.～194B.C.)提出的一种筛选法。 是针对自然数列中的自然数而实施的，用于求一定范围内的质数，它的容斥原理之完备性条件是p=H~。
    埃氏筛法步骤编辑
    （1）先把1删除（现今数学界1既不是质数也不是合数）
    （2）读取队列中当前最小的数2，然后把2的倍数删去
    （3）读取队列中当前最小的数3，然后把3的倍数删去
    （4）读取队列中当前最小的数5，然后把5的倍数删去
    （5）读取队列中当前最小的数7，然后把7的倍数删去
    （6）如上所述直到需求的范围内所有的数均删除或读取
    ![Eratosthenes](./Sieve_of_Eratosthenes_animation.gif)
