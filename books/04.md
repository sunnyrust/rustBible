# Hello, Cargo!
[TOC]
Cargoæ˜¯Rustçš„æ„å»ºç³»ç»Ÿå’ŒåŒ…ç®¡ç†å™¨ã€‚å¤§å¤šæ•°Rustaceans(*æ³¨1)ä½¿ç”¨è¿™ä¸ªå·¥å…·æ¥ç®¡ç†ä»–ä»¬çš„Rusté¡¹ç›®ï¼Œå› ä¸ºCargoä¸ºä½ å¤„ç†äº†å¾ˆå¤šä»»åŠ¡ï¼Œæ¯”å¦‚æ„å»ºä½ çš„ä»£ç ï¼Œä¸‹è½½ä½ çš„ä»£ç æ‰€ä¾èµ–çš„åº“ï¼Œä»¥åŠæ„å»ºè¿™äº›åº“ã€‚

## æŸ¥çœ‹cargo ç‰ˆæœ¬

```shell
$ cargo --version
cargo 1.50.0 (f04e7fab7 2021-02-04)
```
## ä½¿ç”¨cargo åšhello world
```shell
$ cargo new hello_world
Created binary (application) `hello_world` package

$ tree
.
â””â”€â”€ hello_world
    â”œâ”€â”€ Cargo.toml
    â””â”€â”€ src
        â””â”€â”€ main.rs

2 directories, 2 files

$ cat Cargo.toml
[package]
name = "hello_world" # project åç§°
version = "0.1.0"             # ç‰ˆæœ¬
authors = ["sunny <jinheking@gmail.com>"] #ä½œè€…
edition = "2018"       # ä½¿ç”¨Rustçš„ç‰ˆæœ¬ *æ³¨2

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[dependencies]


$ cat src/main.rs
fn main() {
    println!("Hello, world!");
}
```
æˆ‘ä»¬åšä¸€ä¸‹ç®€å•çš„ä¿®æ”¹
```rust
fn main() {
    println!("ğŸ˜€ğŸ˜€ğŸ˜€Hello, Cargo!ğŸ‰ğŸ‰ğŸ‰");
}
```

## ä½¿ç”¨cargo run è¿è¡Œ

```shell
$ cargo run
    Finished dev [unoptimized + debuginfo] target(s) in 0.00s
     Running `target/debug/hello_world`
ğŸ˜€ğŸ˜€ğŸ˜€Hello, Cargo!ğŸ‰ğŸ‰ğŸ‰
```

å¦‚æœä¸æƒ³çœ‹ç¼–è¯‘æç¤ºä¿¡æ¯
```shell
$ cargo run -q
ğŸ˜€ğŸ˜€ğŸ˜€Hello, Cargo!ğŸ‰ğŸ‰ğŸ‰
```

å…¶å®ƒçš„ä¿¡æ¯
```shell
$ cargo run --help
cargo-run 
Run a binary or example of the local package

USAGE:
    cargo run [OPTIONS] [--] [args]...

OPTIONS:
    -q, --quiet                      No output printed to stdout
        --bin <NAME>...              Name of the bin target to run
        --example <NAME>...          Name of the example target to run
    -p, --package <SPEC>             Package with the target to run
    -j, --jobs <N>                   Number of parallel jobs, defaults to # of CPUs
        --release                    Build artifacts in release mode, with optimizations
        --profile <PROFILE-NAME>     Build artifacts with the specified profile
        --features <FEATURES>...     Space or comma separated list of features to activate
        --all-features               Activate all available features
        --no-default-features        Do not activate the `default` feature
        --target <TRIPLE>...         Build for the target triple
        --target-dir <DIRECTORY>     Directory for all generated artifacts
        --manifest-path <PATH>       Path to Cargo.toml
        --message-format <FMT>...    Error format
    -v, --verbose                    Use verbose output (-vv very verbose/build.rs output)
        --color <WHEN>               Coloring: auto, always, never
        --frozen                     Require Cargo.lock and cache are up to date
        --locked                     Require Cargo.lock is up to date
        --offline                    Run without accessing the network
    -Z <FLAG>...                     Unstable (nightly-only) flags to Cargo, see 'cargo -Z help' for details
    -h, --help                       Prints help information

ARGS:
    <args>...    

Run `cargo help run` for more detailed information.

```

## ä½¿ç”¨cargo buildç¼–è¯‘ç¨‹åº
```shell
$ cargo build
   Compiling hello_world v0.1.0 (/home/sunny/project/rust/bible/src/02/hello_world)
    Finished dev [unoptimized + debuginfo] target(s) in 0.31s

$ tree 
.
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src
â”‚Â Â  â””â”€â”€ main.rs
â””â”€â”€ target
    â”œâ”€â”€ CACHEDIR.TAG
    â””â”€â”€ debug
        â”œâ”€â”€ build
        â”œâ”€â”€ deps
        â”‚Â Â  â”œâ”€â”€ hello_world-f8c125f47c8f5afa
        â”‚Â Â  â””â”€â”€ hello_world-f8c125f47c8f5afa.d
        â”œâ”€â”€ examples
        â”œâ”€â”€ hello_world
        â”œâ”€â”€ hello_world.d
        â””â”€â”€ incremental
            â””â”€â”€ hello_world-36vp7qxo7l8ni
                â”œâ”€â”€ s-fw3qk42i3z-16x9v18-2h6b13evgzpis
                â”‚Â Â  â”œâ”€â”€ 19hmawvdfnpp46eb.o
                â”‚Â Â  â”œâ”€â”€ 1wtsdbxwnuqz3agy.o
                â”‚Â Â  â”œâ”€â”€ 2hfb323hf9pmhesn.o
                â”‚Â Â  â”œâ”€â”€ 2tnojagzwrv5tmen.o
                â”‚Â Â  â”œâ”€â”€ 3dom19a91e8li7lh.o
                â”‚Â Â  â”œâ”€â”€ 3eyhsxws2m2n7h68.o
                â”‚Â Â  â”œâ”€â”€ 4a90bg5badtu5ush.o
                â”‚Â Â  â”œâ”€â”€ dep-graph.bin
                â”‚Â Â  â”œâ”€â”€ query-cache.bin
                â”‚Â Â  â”œâ”€â”€ rlpmoqdrgrdrx94.o
                â”‚Â Â  â””â”€â”€ work-products.bin
                â””â”€â”€ s-fw3qk42i3z-16x9v18.lock

9 directories, 20 files

```

å¤šå‡ºæ¥ä¸€ä¸ªtarget ç›®å½•ï¼Œtagetä¸‹é¢å¤šäº†ä¸€ä¸ªdebugç›®å½•ï¼Œè¿™ä¸ªè¯´æ˜æˆ‘ç¼–è¯‘çš„æ˜¯ä¸€ä¸ªdebugç±»å‹çš„æ‰§è¡Œæˆè¯­ï¼Œè¦æ˜¯çœŸçš„ä½¿ç”¨çš„æ—¶å€™ï¼Œè¦ä½¿ç”¨

```shell
$ cargo build --release
   Compiling hello_world v0.1.0 (/home/sunny/project/rust/bible/src/02/hello_world)
    Finished release [optimized] target(s) in 0.30s

$ tree
.
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src
â”‚Â Â  â””â”€â”€ main.rs
â””â”€â”€ target
    â”œâ”€â”€ CACHEDIR.TAG
    â””â”€â”€ release
        â”œâ”€â”€ build
        â”œâ”€â”€ deps
        â”‚Â Â  â”œâ”€â”€ hello_world-b728ba6c2774d0a3
        â”‚Â Â  â””â”€â”€ hello_world-b728ba6c2774d0a3.d
        â”œâ”€â”€ examples
        â”œâ”€â”€ hello_world
        â”œâ”€â”€ hello_world.d
        â””â”€â”€ incremental

7 directories, 8 files
```
åœ¨æˆ‘çš„ubuntuä¸‹debugå’Œreleaseç¼–è¯‘çš„æ‰§è¡Œæ–‡ä»¶å¤§å°ä¸ä¸€æ ·

```shell
-rwxr-xr-x 2 sunny sunny 3330128 Feb 22 12:26 hello_world*  # debug ç¼–è¯‘

-rwxr-xr-x 2 sunny sunny 3319736 Feb 22 12:25 hello_world* # release ç¼–è¯‘
```
### debugå’Œreleaseçš„åŒºåˆ«
debugæ˜¯ä¸åšç¼–è¯‘ä¼˜åŒ–çš„ï¼Œreleaseæ˜¯è¦åšç¼–è¯‘ä¼˜åŒ–çš„ï¼Œé»˜è®¤çš„ä¼˜åŒ–æ˜¯-O3ã€‚<br />
ä¹Ÿå¯ä»¥åœ¨Cargo.tomlé‡Œé¢è®¾ç½®

    [profile.release]
    opt-level = 3

å…·ä½“çš„å‚æ•°å¦‚ä¸‹ï¼š

        opt-level    
        
        0: no optimizations
        1: basic optimizations
        2: some optimizations
        3: all optimizations
        s: optimize for binary size
        z: optimize for binary size, but also turn off loop vectorization.
### ä¼˜åŒ– Rust ç¨‹åºç¼–è¯‘ä½“ç§¯

cargoé»˜è®¤çš„ç¼–è¯‘æ˜¯debugï¼Œæœ¬æ¬¡å°±ä½¿ç”¨ä¸Šé¢çš„ç¨‹åºåšä¾‹å­ã€‚
```rust
fn main() {
    println!("ğŸ˜€ğŸ˜€ğŸ˜€Hello, Cargo!ğŸ‰ğŸ‰ğŸ‰");
}
```

#### æ— ä¼˜åŒ–

|ç¼–è¯‘æ¨¡å¼|å¤§å°|å‡å°‘é‡|
|---|---:|---:|
|debug|3330128|100%|
|release|3319736|0.312%|

#### ä½¿ç”¨stripè¿›è¡Œå‹ç¼©

```shell
$ strip -s target/debug/hello_world 
$ strip -s target/release/hello_world
$ ls target/debug/hello_world -l
-rwxr-xr-x 2 sunny sunny 293216 Feb 22 12:57 target/debug/hello_world
$ ls target/release/hello_world -l
-rwxr-xr-x 2 sunny sunny 293136 Feb 22 12:57 target/release/hello_world
```
|ç¼–è¯‘æ¨¡å¼|å¤§å°|å‡å°‘é‡|
|---|---:|---:|
|debug|293216|91.195%|
|release|293136|91.197%|

#### å¼€å¯ LTO
LTOï¼ˆLink Time Optimizationï¼‰ï¼Œæ„ä¸ºé“¾æ¥æ—¶ä¼˜åŒ–ã€‚å¯ä»¥æ¶ˆé™¤å¤§é‡å†—ä½™ä»£ç ï¼Œå‡å°äºŒè¿›åˆ¶ä½“ç§¯â€”â€”ä»£ä»·æ˜¯æ›´é•¿çš„ç¼–è¯‘æ—¶é•¿ã€‚

|ç¼–è¯‘æ¨¡å¼|å¤§å°|å‡å°‘é‡|
|---|---:|---:|
|debug|3330128|100%|
|release|1420032|57.358%|

#### å¼€å¯ LTOå¹¶ strip
|ç¼–è¯‘æ¨¡å¼|å¤§å°|å‡å°‘é‡|
|---|---:|---:|
|debug|293216|91.195%|
|release|260368|92.181%|


## ä½¿ç”¨cargo check
åˆ†æé¡¹ç›®æ˜¯ä¸æ˜¯æœ‰errorï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥å¿«é€Ÿæ£€æŸ¥ä½ çš„ä»£ç ï¼Œç¡®ä¿å®ƒèƒ½ç¼–è¯‘ï¼Œä½†ä¸ä¼šäº§ç”Ÿä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚

```shell
$ cargo check
    Checking hello_world v0.1.0 (/home/sunny/project/rust/bible/src/02/hello_world)
    Finished dev [unoptimized + debuginfo] target(s) in 0.08s
$ tree
.
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ src
â”‚Â Â  â””â”€â”€ main.rs
â””â”€â”€ target
    â”œâ”€â”€ CACHEDIR.TAG
    â””â”€â”€ debug
        â”œâ”€â”€ build
        â”œâ”€â”€ deps
        â”‚Â Â  â”œâ”€â”€ hello_world-45147cf78545f637.d
        â”‚Â Â  â””â”€â”€ libhello_world-45147cf78545f637.rmeta
        â”œâ”€â”€ examples
        â””â”€â”€ incremental
            â””â”€â”€ hello_world-qlfi7s04gs0f
                â”œâ”€â”€ s-fw3ykmgb8t-uk8ilj-14jdiuq2e86vd
                â”‚Â Â  â”œâ”€â”€ dep-graph.bin
                â”‚Â Â  â”œâ”€â”€ query-cache.bin
                â”‚Â Â  â””â”€â”€ work-products.bin
                â””â”€â”€ s-fw3ykmgb8t-uk8ilj.lock

9 directories, 10 files
```

## ä½¿ç”¨cargo test

## ä½¿ç”¨cargo init å¯ä»¥å¯¹å·²ç»å­˜åœ¨çš„é¡¹ç›®è½¬æˆcargoç»“æ„
æ¯”å¦‚ä¸Šä¸€ç« çš„ç¨‹åº
```shell
$ cargo init --name hello
     Created binary (application) package

$ tree
.
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ helloworld.rs
â””â”€â”€ src
    â””â”€â”€ main.rs

1 directory, 3 files
```

- æ³¨1ï¼šRustaceans å­—é¢çš„æ„æ€æ˜¯é”ˆèŒï¼Œè¿™é‡ŒæŒ‡â˜Rustç¨‹åºå‘˜ã€‚å±äºæ˜µç§°ã€‚ç±»ä¼¼äºç å†œã€ç¨‹åºçŒ¿ã€‚

- æ³¨2ï¼šRustè¯­è¨€å’Œç¼–è¯‘å™¨æ¯å…­å‘¨å‘å¸ƒä¸€æ¬¡æ–°ç‰ˆæœ¬ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥æºæºä¸æ–­çš„è·å¾—æ–°åŠŸèƒ½ã€‚ä¸å…¶å®ƒè¯­è¨€ç›¸æ¯”ï¼ŒRustå‘å¸ƒæ›´æ–°é¢‘ç‡æ›´é«˜ï¼ŒåŒæ—¶ç‰ˆæœ¬ä¹‹å‰çš„å·®å¼‚ä¹Ÿæ›´å°ã€‚ä¸€æ®µæ—¶é—´åï¼Œæ‰€æœ‰è¿™äº›å¾®å°çš„å˜åŒ–ä¼šå˜æˆä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç‰ˆæœ¬ã€‚ä¸è¿‡ï¼Œä»ä¸€ä¸ªå°ç‰ˆæœ¬åˆ°å¦ä¸€ä¸ªå°ç‰ˆæœ¬ï¼Œå¾ˆéš¾å›å¤´è¯´ï¼š"å“‡ï¼Œåœ¨Rust 1.10å’ŒRust 1.31ä¹‹é—´ï¼ŒRustæ”¹å˜äº†å¾ˆå¤šï¼"<br />
æ¯éš”2-3å¹´Rustæ ¸å¿ƒå›¢é˜Ÿå°†å‘å¸ƒä¸€ä¸ªæ–°çš„Editionã€‚æ¯ä¸ªç‰ˆæœ¬éƒ½å°†åŠŸèƒ½é›†æˆåˆ°ä¸€ä¸ªæ¸…æ™°çš„åŒ…ä¸­ï¼Œå¹¶æä¾›å…¨é¢æ›´æ–°çš„æ–‡æ¡£å’Œå·¥å…·ã€‚ æ–°ç‰ˆæœ¬é€šè¿‡ä¸€èˆ¬çš„å‘å¸ƒæµç¨‹å‘å¸ƒã€‚<br />
ç›®å‰æœ‰çš„Editionæœ‰2015å’Œ2018ã€‚



2021-02-22