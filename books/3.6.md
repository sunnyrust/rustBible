
# 3.6 å­—ç¬¦ä¸²

[TOC]

## åŸºç¡€å¸¸è¯†
Rustçš„å­—ç¬¦ä¸²æ¦‚å¿µä¹Ÿä¸ä¼—ä¸åŒï¼ŒRust ä¸­ä¸»è¦æœ‰ä¸¤ç§å­—ç¬¦ä¸²ç±»å‹ï¼š`String` å’Œ `&str`ã€‚

åˆšä½¿ç”¨çš„æ—¶å€™å¾ˆå®¹æ˜“è¢«Rustçš„å­—ç¬¦ä¸²ææ··æ‰ï¼Œæ¯”å¦‚strï¼ŒStringï¼Œ OsStrï¼Œ CStrï¼ŒCStringç­‰ç­‰â€¦â€¦äº‹å®ä¸Šï¼Œå¦‚æœä½ ä¸åšFFIçš„è¯ï¼Œå¸¸ç”¨çš„å­—ç¬¦ä¸²ç±»å‹å°±åªæœ‰å‰ä¸¤ç§(strã€String)ã€‚

å…¶å®Rust çš„æ ¸å¿ƒè¯­è¨€ä¸­åªæœ‰ä¸€ç§å­—ç¬¦ä¸²ç±»å‹ï¼šstrï¼Œå­—ç¬¦ä¸² sliceï¼Œå®ƒé€šå¸¸ä»¥è¢«å€Ÿç”¨çš„å½¢å¼å‡ºç°ï¼Œ`&str`ã€‚å­—ç¬¦ä¸² sliceï¼šå®ƒä»¬æ˜¯ä¸€äº›å‚¨å­˜åœ¨åˆ«å¤„çš„ UTF-8 ç¼–ç å­—ç¬¦ä¸²æ•°æ®çš„å¼•ç”¨ã€‚åœ¨ Rust ä¸­,&str ç±»å‹ï¼Œä¸å¯å˜çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ç§°ä¸ºå­—é¢é‡ï¼Œæ‹¥æœ‰å›ºæ€ç”Ÿå‘½å‘¨æœŸï¼ˆ'staticï¼‰,ç±»å‹æ˜¯ & 'static strï¼Œå› ä¸ºå®ƒä¼šè¢«ç›´æ¥å‚¨å­˜åœ¨ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶é‡Œã€‚



```rust
let a = "Hello, world."; // a: &'static str 
let b: &str = "ã“ã‚“ã«ã¡ã¯, ä¸–ç•Œ!";
```
String çš„ç±»å‹æ˜¯ç”±æ ‡å‡†åº“æä¾›çš„ï¼Œè€Œæ²¡æœ‰å†™è¿›æ ¸å¿ƒè¯­è¨€éƒ¨åˆ†ï¼Œå®ƒæ˜¯å¯å¢é•¿çš„ã€å¯å˜çš„ã€æœ‰æ‰€æœ‰æƒçš„ã€UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ç±»å‹ã€‚
```rust
pub struct String {
    vec: Vec<u8>,
}
```
String è¢«å­˜å‚¨ä¸ºç”±å­—èŠ‚ç»„æˆçš„ vectorï¼ˆ`Vec<u8>`ï¼‰ï¼Œä½†ä¿è¯äº†å®ƒä¸€å®šæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ UTF-8 åºåˆ—,String æ˜¯å †åˆ†é…çš„ï¼Œå¯å¢é•¿çš„ï¼Œä¸”ä¸æ˜¯é›¶ç»“å°¾çš„rï¼ˆnull terminatedï¼‰ã€‚&str æ˜¯ä¸€ä¸ªæ€»æ˜¯æŒ‡å‘æœ‰æ•ˆ UTF-8 åºåˆ—çš„åˆ‡ç‰‡ï¼ˆ&[u8]ï¼‰ï¼Œå¹¶å¯ç”¨æ¥æŸ¥çœ‹ String çš„å†…å®¹ï¼Œå°±å¦‚åŒ &[T] æ˜¯` Vec<T>` çš„å…¨éƒ¨æˆ–éƒ¨åˆ†å¼•ç”¨ã€‚String æ˜¯æ ‡å‡†åº“æä¾›çš„ä¸€ç§ç»“æ„ä½“ï¼Œå†…éƒ¨å­˜å‚¨ä¸€ä¸ª u8 ç±»å‹çš„ Vecï¼š

```rust
let mut sunny_string = String::from("Hello, world!");
sunny_string+="Rustacean";  // å­—ç¬¦ä¸²è¿æ¥
println!("{}",sunny_string);
```
æ›´å¤š str/String ç›¸å…³ä¿¡æ¯å¯ä»¥åœ¨ [std::str](https://doc.rust-lang.org/std/str/) å’Œ [std::string](https://doc.rust-lang.org/std/string/) æ¨¡å—ä¸­æ‰¾åˆ°ã€‚

## å­—ç¬¦ä¸²ç¼–ç 
```rust
// å°†UTF-8åºåˆ—è½¬ä¸ºå­—ç¬¦ä¸²
let tao = std::str::from_utf8(&[0xE9u8, 0x81u8, 0x93u8]).unwrap();
assert_eq!("é“", tao);

//æ±‰å­—è½¬unicode
let ch ='é“' as i32;// unicode ç 
let ch_unicode = format!("{:X}",ch);  //9053


// å°†16è¿›åˆ¶Unicodeç ä½è½¬ä¸ºå­—ç¬¦ä¸²
assert_eq!("é“", String::from("\u{9053}")); 

// é€šè¿‡è½¬ä¹‰ï¼Œå¯ä»¥ç”¨åå…­è¿›åˆ¶å€¼æ¥è¡¨ç¤ºå­—èŠ‚ã€‚
let byte_escape = "I'm writing \x52\x75\x73\x74!";
println!("What are you doing\x3F (\\x3F means ?) {}", byte_escape);

// æ³¨æ„è¿™å¹¶ä¸æ˜¯ä¸€ä¸ª &str
let bytestring: &[u8] = b"I'm a Rustacean!";

// å­—èŠ‚ä¸²æ²¡æœ‰å®ç° Displayï¼Œæ‰€ä»¥å®ƒä»¬çš„æ‰“å°åŠŸèƒ½ä¸å…¨
println!("A bytestring: {:?}", bytestring);

// å­—èŠ‚ä¸²å¯ä»¥ä¸ä½¿ç”¨ UTF-8 ç¼–ç 
    let shift_jis = b"\x82\xe6\x82\xa8\x82\xb1\x82"; // SHIFT-JIS ç¼–ç çš„ "ã‚ˆã†ã“ã"

    // ä½†è¿™æ ·çš„è¯å®ƒä»¬å°±æ— æ³•è½¬æ¢æˆ &str äº†
    match str::from_utf8(shift_jis) {
        Ok(my_str) => println!("Conversion successful: '{}'", my_str),
        Err(e) => println!("Conversion failed: {:?}", e),
    };
```

è‹¥éœ€è¦åœ¨ç¼–ç é—´è½¬æ¢ï¼Œè¯·ä½¿ç”¨ [encoding](https://crates.io/crates/encoding) crateã€‚

Rust å‚è€ƒä¸­çš„ [Tokens](https://doc.rust-lang.org/reference/tokens.html) ä¸€ç« è¯¦ç»†åœ°åˆ—å‡ºäº†ä¹¦å†™å­—ç¬¦ä¸²å­—é¢é‡å’Œè½¬ä¹‰å­—ç¬¦çš„æ–¹æ³•ã€‚
## str å’Œ Stringç›¸äº’è½¬æ¢
 
 - ### &str -> String
```rust
let str_sunny = "I'm a Rustacean!"; // variable s: &str

let s1 = String::from(str_sunny); // variable s1: String
let s1 = s.to_string();
let s1 = s.to_owned();
```
 - ### String->&str 
 
```rust
let string_sunny = String::from("I'm a Rustacean!"); // variable s: String
let s1 = string_sunny.as_str(); // variable s1: &str
let s1 = &string_sunny[..]; // ç›¸å½“äºï¼š&string_sunny[0..s.len()];
```

- ### &String å¯ä»¥å½“åšæ˜¯ &strï¼Œä¾‹å¦‚ï¼š

```rust
fn show(s: &str) {
    println!("{}", s);
}

fn main(){
    let str_sunny = String::from("I'm a Rustacean!");
    show(&str_sunny);
}

```


## éå†å­—ç¬¦ä¸²

```rust
fn main() {
    let str_sunny  = String::from("I'm a Rustacean!");
    for c in str_sunny.chars(){
        println!("c = {}",c);
    }

    println!("------------------------");

    //æŒ‰å­—èŠ‚æ¥æ‰“å°è¾“å‡ºå­—ç¬¦ä¸²
    for b in str_sunny.bytes(){
        println!("b = {}",b);
    }

    println!("------------------------");
    let str_sunny  = String::from("æˆ‘æ˜¯ä¸€ä¸ªé”ˆèŒ");
    //æŒ‰å­—èŠ‚æ¥æ‰“å°è¾“å‡ºå­—ç¬¦ä¸²
    for b in str_sunny.bytes(){
        println!("b = 0x{:x}",b);
    }
}
```

## Raw Stringç±»å‹å­—ç¬¦ä¸²
è¿™ä¸ªæ¦‚å¿µå’ŒPythonè¯­è¨€é‡Œé¢çš„Raw Stringæ˜¯ä¸€æ ·çš„,å¯ä»¥æŠŠè½¬ä¹‰å­—ç¬¦æ­£å¸¸çš„æ‰“å°å‡ºæ¥ã€‚å†™æ³•æ˜¯`r""`æˆ–`r#""#`:
```rust
println!(r#"--------\r\n----------------"#);

let s1 = r"abc";   // -> abc
 let s2 = r"abc'"; // -> abc'
 let s3 = r"é“";  // -> é“
 let s4 = r"\x41"; // -> \x41
 let s5 = r"\n"; // -> \n
 let s6 = r"\u{9053}\u{9053}"; // -> \u{9053}\u{9053} è¦ä¸ç„¶è¾“å‡ºçš„åº”è¯¥è¾“å‡º"é“é“"
 let s7 = r#"""#;  // -> "
 let s8 = r"###"; // -> ###
 let s9 = r#"I'm 
 â€‹
     a Rustacean!"#;  // -> I'm\n\n\ta Rustacean!
```
## raw byte string literalsï¼ˆrustç±»å‹æ˜¯ï¼š&[u8; usize]ï¼‰
raw byte stringä¸å¤„ç†ä»»æ„è½¬ç§»å­—ç¬¦ï¼Œä»¥brå¼€å¤´ï¼Œä¸­é—´æ˜¯ä»»ä½•çš„ASCIIåºåˆ—ï¼Œunicodeæ˜¯ä¸è¡Œçš„ã€‚

```rust
let s1 = br"abc"; // -> [97, 98, 99]
let s2 = br"123"; // -> [49, 50, 51]
```
## å­—ç¬¦ä¸²çš„å®¹é‡
å®¹é‡ï¼ˆå¯å­˜å‚¨çš„å­—èŠ‚æ•°ï¼‰ä½¿ç”¨ capacity()æ–¹æ³•ã€‚

```rust
let  str_capacity = String::from("I'm a Rustacean!ğŸ’–"); 
println!("I'm a Rustacean!ğŸ’–  Capacity:{}",str_capacity.capacity());//I'm a Rustacean!ğŸ’–  Capacity:20  

```

## åˆ¤æ–­æ˜¯å¦ä¸ºç©º
is_empty()æ–¹æ³•ç”¨äºæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆtrueæˆ–falseï¼‰ã€‚
```rust
let  str_capacity = String::from("I'm a Rustacean!ğŸ’–"); 
println!("I'm a Rustacean!ğŸ’–  is_empty:{}",str_capacity.is_empty());//I'm a Rustacean!ğŸ’–  is_empty:false  

```

## å­—ç¬¦ä¸²æ‹¼æ¥

- ### push

```rust
let mut str_source = String::from("I'm a Rustacean");   //ä¸€å®šè¦æ˜¯mutè¿™ç§å¯å˜ç±»å‹
let char= '!'; 
str_source.push_str(char);  
println!("{}",str_source); // --> I'm a Rustacean!
```
- ### push_str

```rust
 let mut str_source = String::from("I'm a ");   //ä¸€å®šè¦æ˜¯mutè¿™ç§å¯å˜ç±»å‹
 let str_tail = "Rustacean!";  
 str_source.push_str(str_tail);  
 println!("{}",str_source); // --> I'm a Rustacean!
 println!("{}",str_tail); // --> Rustacean! è¯´æ˜ä½¿ç”¨push_str()å¹¶ä¸ä¼šæ”¹å˜å‚æ•°çš„æ‰€æœ‰æƒ
```

- ### +
ä½ å¯ä»¥ä»ä¸€ä¸ªç°æœ‰çš„å­—ç¬¦ä¸²å’Œå¦ä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œé€šè¿‡ç”¨+è¿æ¥


```rust
let s:std::string::String = "I'm a ".to_string();
let message = s + "Rustacean!ğŸ’–";
println!("{}",message);
```
ä¸Šé¢çš„æ“ä½œæ²¡æœ‰é—®é¢˜ï¼Œé‚£æ˜¯å› ä¸ºæ˜¯Stringå’Œ&'static stråšçš„æ“ä½œã€‚å¦‚æœæ˜¯ä¸¤ä¸ªStringç›´æ¥ã€+ã€‘ä¼šæ€ä¹ˆæ ·å“ªï¼Ÿ

```rust

let mut str_source = String::from("I'm a ");   //ä½¿ç”¨mutä¹Ÿç…§æ ·æœ‰é—®é¢˜
let str_tail = "Rustacean!ğŸ’–".to_string();

let str_source = str_source + str_tail;
println!("{}",str_source);

```

```shell
error[E0308]: mismatched types
  --> src/main.rs:51:35
   |
51 |     let str_source = str_source + str_tail.to_string();
   |                                   ^^^^^^^^^^^^^^^^^^^^
   |                                   |
   |                                   expected `&str`, found struct `String`
   |                                   help: consider borrowing here: `&str_tail.to_string()`

error: aborting due to previous error

For more information about this error, try `rustc --explain E0308`.
```

ä¸ºä»€ä¹ˆå“ªï¼Ÿ
Rustçš„äº®ç‚¹æ˜¯ç”±æ‰€æœ‰æƒã€å€Ÿç”¨ã€ç”Ÿå‘½å‘¨æœŸä¸‰å¤§è¦ç´ æ„æˆçš„æ ¸å¿ƒç³»ç»Ÿï¼Œå®ƒä¿è¯äº†Rustç¨‹åºä¸ä¼šå‡ºç°ã€ŒæŒ‡é’ˆé‡Šæ”¾åå†ä½¿ç”¨ã€ã€ã€Œç”³è¯·å†…å­˜å´å¿˜è®°é‡Šæ”¾ã€ç­‰é—®é¢˜ã€‚

ä¸€ä¸ªå˜é‡ç»‘å®šï¼Œå˜é‡å¯¹æ•°æ®å…·æœ‰æ‰€æœ‰æƒã€‚åŒæ—¶æ•°æ®å¯ä»¥ã€Œå€Ÿå‡ºã€ï¼Œé€šè¿‡å€Ÿç”¨æ“ä½œç¬¦ï¼ˆ&ï¼‰ï¼š

ä¸Šé¢ç¨‹åºæ”¹æˆä¸‹é¢çš„å°±OK

```rust
let str_source = String::from("I'm a ");  //ä¸ç”¨ä½¿ç”¨mutè¿™ç§ç±»å‹
let str_tail = "Rustacean!ğŸ’–";

let str_source = str_source + &str_tail.to_string();
println!("{}",str_source);
```
> å˜é‡vectorå¯¹å †ä¸Šçš„æ•°ç»„å…·æœ‰æ‰€æœ‰æƒï¼ŒåŒæ—¶å¯ä»¥å°†æ•°æ®ã€Œå€Ÿç»™ã€do_something_with_vectorå‡½æ•°ï¼Œ&åé¢è·Ÿmutè¡¨ç¤ºå…è®¸æ¥æ”¶æ–¹ä¿®æ”¹æ•°æ®ã€‚å¦‚æœä¸ä½¿ç”¨å€Ÿç”¨æ“ä½œç¬¦ï¼Œåˆ™vectorçš„æ‰€æœ‰æƒè½¬ç§»ç»™å‡½æ•°do_something_with_vectorï¼Œå‡½æ•°è°ƒç”¨ä¹‹åï¼Œæ‰€æœ‰çš„å¯¹vectorçš„æ“ä½œå‡ä¼šè§¦å‘ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºvectorçš„ç”Ÿå‘½å‘¨æœŸå·²ç»“æŸã€‚

> å› ä¸ºStringä¸æ”¯æŒCopyç‰¹æ€§ï¼Œä»è®¾è®¡ä¸Šè€Œè¨€Stringä¸éœ€è¦å®ç°Copyï¼Œè¿™ä¿è¯äº†ä»…æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡å¯¹åº”ä¸€ä¸ªå †ä¸Šçš„å­—ç¬¦ä¸²ã€‚

> Copyç‰¹æ€§ç›¸å½“äºæµ…æ‹·è´ï¼Œå¯¹å®ç°äº†Copyç‰¹æ€§çš„ç±»å‹Tï¼Œå½“Tç±»å‹å˜é‡vä½œä¸ºå®å‚ä¼ ç»™å‡½æ•°ï¼Œå‡½æ•°æ”¶åˆ°çš„æ˜¯vå¯¹åº”æ•°æ®çš„æ‹·è´ç‰ˆæœ¬ã€‚Stringç±»å‹ï¼Œä»å˜é‡çš„è§’åº¦è€ƒè™‘ï¼Œå˜é‡ï¼ˆåœ¨æ ˆä¸Šï¼‰åŒ…å«ä¸€ä¸ªæŒ‡å‘å †ä¸Šå­—ç¬¦ä¸²æ•°æ®çš„æŒ‡é’ˆã€‚å¯¹Stringå®ç°æµ…æ‹·è´ä¼šå¯¼è‡´å¤šä¸ªStringå˜é‡å¯¹åº”åŒä¸€ä¸ªå †ä¸Šçš„å­—ç¬¦ä¸²ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªStringå˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼Œææ„å‡½æ•°è¢«è°ƒç”¨ï¼Œå…¶ä»–Stringå˜é‡è¿˜åœ¨ç”Ÿå‘½å‘¨æœŸå†…ï¼Œåˆ™äº§ç”Ÿäº†æ‚¬å‚æŒ‡é’ˆã€‚è¿™ä¹Ÿæ˜¯Rustç»å¯¹ä¸å…è®¸çš„ã€‚

## å­—ç¬¦ä¸²æ›¿æ¢
```rust
    let mut str_sunny = String::from("I'm a Rustacean!");
    let result= str_sunny.replace(r#"'m"#," am");
    println!("{:?}", result);  // -> I am a Rustaceans!
```
## å­—ç¬¦ä¸²åˆ‡å‰²

```rust
    let mut str_sunny = String::from("I'm a Rustacean!");
    let result: Vec<&str> = str_sunny.split(" ").collect();
    println!("{:?}", result);  // -> ["I\'m", "a", "Rustacean!"]
```
### é€šè¿‡å­—ç¬¦åˆ†å‰²
```rust
let v: Vec<&str> = "Mary had a little lamb".split(' ').collect(); 
assert_eq!(v, ["Mary", "had", "a", "little", "lamb"]); 
```
### é€šè¿‡å­—ç¬¦ä¸²åˆ†å‰²
```rust
let v: Vec<&str> = "lion::tiger::leopard".split("::").collect(); 
assert_eq!(v, ["lion", "tiger", "leopard"]); 
````
###  é€šè¿‡ç©ºç™½åˆ†å‰²

```rust
 let words: Vec<&str> = " foo bar\t\nbaz ".split_whitespace().collect(); 
println!("{:?}", words); 
 // ["foo", "bar", "baz"] 
```

### æ–¯æ™®åˆ©ç‰¹å…³é—­

```rust
let v: Vec<&str> = "abc1def2ghi".split(|c: char| c.is_numeric()).collect(); 
assert_eq!(v, ["abc", "def", "ghi"]); 
```
## å­—ç¬¦ä¸²è½¬æ¢ä¸ºf32
```rust
let str = "10.0";
let f: f32 = match str.parse() {
    Ok(v) => v,
    Err(_) => 0.0 // or whatever error handling
};
```
2021-03-08

2021-03-20  æ˜¥åˆ†
