# é«˜çº§è·¯ç”±é…ç½®æ–‡ä»¶
[TOC]

æˆ‘ä»¬æ¯æ¬¡å¢åŠ ä¸€æ¡è®¿é—®å°±è¦å†™ä¸€æ¡è·¯ç”±ï¼Œå°±åƒä¸‹é¢ä¸€æ ·:

```rust
let app = Router::new()
    .route("/greet", get(|| async { "Hello, axum World!ğŸŒ±ğŸŒ" }))
    .route("/", get(root))
    .route("/do", get(get_fun).post(post_fun))
    .route("/index/ping", get(controller::index::ping))
    .route("/index/info", get(controller::index::getwebinfo))
```

æ¯å¢åŠ ä¸€ä¸ªè·¯ç”±å°±è¦åœ¨`main.rs`é‡Œé¢å¢åŠ ä¸€æ¡ï¼Œè¿™ä¸ªå¾ˆéº»çƒ¦ã€‚

å½“ç„¶ä½ ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªå…¨å±€çš„`router.rs`æ–‡ä»¶æ¥æ•´ä½“çš„å¤„ç†è¿™äº›è¯·æ±‚ï¼Œä¸è¿‡ä¹Ÿæ˜¯è¦ç»Ÿä¸€ç®¡ç†ï¼Œè¿™ä¸ªå¾ˆä¸åˆ©äºå¤§å®¶å¹¶è¡Œå¼€å‘ï¼Œå› ä¸ºä½¿ç”¨`cvs`å·¥å…·ï¼Œä½ åˆæ˜¯ç»å¸¸å¤§å®¶ä¸€èµ·å¤„ç†åŒä¸€ä¸ªæ–‡ä»¶ï¼Œéš¾å…å°±ä¼šæœ‰å¤„ç†å†²çªçš„äº‹æƒ…å‘ç”Ÿã€‚

ä¸€èˆ¬çš„`MVC`æ¶æ„éƒ½ä¼šæœ‰ä¸€ç§æ–¹å¼ï¼Œæ˜¯åœ¨`controller`é‡Œé¢é…ç½®è·¯ç”±ã€‚

## åœ¨æ¯ä¸ª`controller`é‡Œé¢é…ç½®è‡ªå·±çš„è·¯ç”±
è¿™ä¸ªæ–¹å¼éœ€è¦ä½¿ç”¨åˆ°`tower`,Tower æ˜¯ä¸€ä¸ªä¸“æ³¨äºå¯¹ç½‘ç»œç¼–ç¨‹è¿›è¡ŒæŠ½è±¡çš„æ¡†æ¶ï¼Œå°†ç½‘ç»œç¼–ç¨‹ä¸­çš„å„è¡Œä¸ºè¿›è¡ŒæŠ½è±¡ä»è€Œæé«˜ä»£ç å¤ç”¨ç‡ã€‚

åœ¨`helloworld-axum`é¡¹ç›®ä¸Šç»§ç»­æ·»åŠ `crate`ã€‚

```shell
$ cargo add tower_http -F "fs,trace"
```
```toml
[dependencies]
tower-http = { version = "0.3.5", features = ["fs", "trace"] }
```

åœ¨`index.rs`é‡Œé¢å¢åŠ ä¸€ä¸ªå‡½æ•°:

```rust
/// æŠŠå½“å‰controlleré‡Œé¢éœ€è¦æš´éœ²çš„è¯·æ±‚ï¼Œå†™æˆå‡½æ•°
pub(crate) fn index_router() -> Router {
    Router::new()
    .route("/greet", get(greet))
    .route("/info", get(getwebinfo))
    .route("/ping", get(ping))
    .layer(TraceLayer::new_for_http())
}
```

æŠŠ`main.rs`é‡Œé¢çš„è·¯ç”±ï¼Œå…¨éƒ¨é›†ä¸­åˆ°`router.rs`æ–‡ä»¶ä¸­

```rust
use axum::routing::{get};
use crate::controller;

pub fn init() -> axum::Router {
    axum::Router::new()
        .route("/greet", get(|| async { "Hello, axum World!ğŸŒ±ğŸŒ" }))
        .nest("/index", controller::index::index_router())
}
```

ä¿®æ”¹`lib.rs`

```rust
pub mod config;
pub mod controller;
pub mod model;
pub mod router;
```

ä¿®æ”¹ä¸€ä¸‹`main.rs`

```rust
use helloworld_axum::{config,controller,router};
use tower_http::{trace::TraceLayer};
async fn main(){
    â€¦â€¦
    let app =  router::init()
            .route("/", get(root))
            .route("/do", get(get_fun).post(post_fun))
            .layer(TraceLayer::new_for_http())
            .layer(Extension(Arc::new(web_info))) ;
    â€¦â€¦
}
```

è¿™ä¸ªæ—¶å€™è¯·æ±‚ä¸€ä¸‹ï¼š

![7.4.x](./7.4.x.jpg)

å¾ˆæ­£ç¡®ï¼Œä½†æ˜¯çœ‹åˆ°å…¶ä¸­ä¸¤è¡Œï¼Œæ„Ÿè§‰å¾ˆåˆ«æ‰­ï¼š

```rust
.route("/", get(root))
.route("/do", get(get_fun).post(post_fun))
```

ä¿®æ”¹ä¸€ä¸‹`lib.rs`

```rus
pub mod config;
pub mod controller;
pub mod model;
pub mod router;

async fn root() -> String {
    String::from("Hello rootğŸ˜€.")
}
async fn get_fun() -> String {
    String::from("get functionğŸ‘‹\n")
}
async fn post_fun() -> String {
    String::from("post functionğŸ \n")
}
```

ä¿®æ”¹ä¸€ä¸‹`main.rs`

```rust
async fn main(){
    â€¦â€¦
    let app =  router::init()
            .layer(TraceLayer::new_for_http())
            .layer(Extension(Arc::new(web_info))) ;
    â€¦â€¦
}
```

è¯·æ±‚äº†ä¸€ä¸‹ï¼Œå¾ˆå®Œç¾ã€‚ä¸é”™ï¼Œæˆ‘ä»¬ä¸‹èŠ‚å†è§ã€‚
